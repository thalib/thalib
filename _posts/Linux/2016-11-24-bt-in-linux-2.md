---
layout: post
title:  "Working with Bluetooth in Linux (Part 2)"
date:   2016-11-24 14:50:06
categories: Linux
tags: bluetooth bluez
excerpt: Working with Bluetooth in Linux (Part 2)
---


### hcitool

hcitool has 3 commands scan, dev and inq for querying deivce information

**hcitool scan** scans for any device and returns the name and the MAC address.

```
$ hcitool scan --refresh
Scanning ...
	00:25:56:D3:DF:78	Dell Wireless 365 Bluetooth Module
	00:1E:DE:21:D0:85	Nokia BH-505
	30:F7:72:67:FF:28	ubuntu-0
	44:1C:A8:25:9B:30	ubuntu-0
```

**hcitool dev** gets the self bt address, that is your bt dongle/adapter

```
$ hcitool dev
Devices:
	hci0	5C:F3:70:66:9D:06
```

**hcitool scan** inquires about the device, and receives the MAC address, clock offset and class. The class tells you what type of device you are talking too, whether it be a bluetooth headset, phone or speakers etc. more info on class can be found on [bluetooth.com](https://www.bluetooth.com/specifications/assigned-numbers/baseband)

```
$ hcitool inq
Inquiring ...
	30:F7:72:67:FF:28	clock offset: 0x3435	class: 0x6c0100
	34:23:87:65:CB:C6	clock offset: 0x4c8b	class: 0x28010c
	E0:94:67:61:BF:DD	clock offset: 0x1d6c	class: 0x2a010c
	5C:31:3E:E2:AF:CB	clock offset: 0x243d	class: 0x7c0100
	00:25:56:D3:DF:78	clock offset: 0x7ff4	class: 0x000000
	44:1C:A8:25:9B:30	clock offset: 0x50e8	class: 0x6c0100
```

**hcitool name** You can get the name of the bt device with name command

```
$ hcitool name 00:1E:DE:21:D0:85
Nokia BH-505
```

### sdptool

sdptool commands provides the interface for performing [SDP](https://www.bluetooth.com/specifications/assigned-numbers/service-discovery) queries on Bluetooth devices.

```
sdptool
sdptool - SDP tool v4.101
Usage:
	sdptool [options] <command> [command parameters]
Options:
	-h		Display help
	-i		Specify source interface
Commands:
	search		Search for a service
	browse		Browse all available services
	records		Request all records
	add 		Add local service
	del 		Delete local service
	get 		Get local service
	setattr		Set/Add attribute to a SDP record
	setseq		Set/Add attribute sequence to a SDP record

Services:
	DID SP DUN LAN FAX OPUSH FTP PRINT HS HSAG HF HFAG SAP PBAP NAP
	GN PANU HCRP HID KEYB WIIMOTE CIP CTP A2SRC A2SNK AVRCT AVRTG
	UDIUE UDITE SEMCHLA SR1 SYNCML SYNCMLSERV ACTIVESYNC HOTSYNC
	PALMOS NOKID PCSUITE NFTP NSYNCML NGAGE APPLE ISYNC GATT
```

Get the local bluetooth adpater information

```
sdptool browse local --tree
Browsing FF:FF:FF:00:00:00 ...
Service Name: SIM Access Server
Service RecHandle: 0x10000
Service Class ID List:
  "SIM Access" (0x112d)
  "Generic Telephony" (0x1204)
Protocol Descriptor List:
  "L2CAP" (0x0100)
  "RFCOMM" (0x0003)
    Channel: 8
Profile Descriptor List:
  "SIM Access" (0x112d)
    Version: 0x0101

Service Name: Headset Audio Gateway
Service RecHandle: 0x10001
Service Class ID List:
  "Headset Audio Gateway" (0x1112)
  "Generic Audio" (0x1203)
Protocol Descriptor List:
  "L2CAP" (0x0100)
  "RFCOMM" (0x0003)
    Channel: 12
Profile Descriptor List:
  "Headset" (0x1108)
    Version: 0x0102

...
...
...

```

Like wise to find services supported by other devices can be listed using

```
sdptool search --bdaddr 00:1E:DE:21:D0:85 SP
```

To queries all bluetooth devices nearby for a specifc service.

```
sdptool search SP
```

To register a service to local bluetooth device.

```
sdptool add SP
Serial Port service registered
```
